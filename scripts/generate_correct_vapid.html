<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ì˜¬ë°”ë¥¸ VAPID í‚¤ ìƒì„±</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        .key-box { background: #f0f0f0; padding: 15px; margin: 10px 0; border-radius: 5px; word-break: break-all; font-family: monospace; font-size: 12px; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>ì˜¬ë°”ë¥¸ VAPID í‚¤ ìƒì„±</h1>
    <button onclick="generate()">í‚¤ ìƒì„±í•˜ê¸°</button>
    <div id="result"></div>
    
    <script>
        function urlBase64(buffer) {
            const bytes = new Uint8Array(buffer);
            let binary = '';
            for (let i = 0; i < bytes.length; i++) {
                binary += String.fromCharCode(bytes[i]);
            }
            return btoa(binary).replace(/\+/g, '-').replace(/\//g, '_').replace(/=/g, '');
        }

        async function generate() {
            try {
                // P-256 ECDSA í‚¤ ìƒì„±
                const keyPair = await crypto.subtle.generateKey(
                    { name: 'ECDSA', namedCurve: 'P-256' },
                    true,
                    ['sign', 'verify']
                );

                // ê³µê°œ í‚¤ë¥¼ raw í˜•ì‹ìœ¼ë¡œ ë‚´ë³´ë‚´ê¸° (65ë°”ì´íŠ¸)
                const publicKeyRaw = await crypto.subtle.exportKey('raw', keyPair.publicKey);
                const publicKeyBase64 = urlBase64(publicKeyRaw);

                // ë¹„ê³µê°œ í‚¤ë¥¼ jwk í˜•ì‹ìœ¼ë¡œ ë‚´ë³´ë‚´ê¸°
                const privateKeyJwk = await crypto.subtle.exportKey('jwk', keyPair.privateKey);
                
                // JWKì˜ d ê°’ì´ ë¹„ê³µê°œ í‚¤
                const privateKeyBase64 = privateKeyJwk.d;

                const html = `
                    <h2>âœ… ìƒì„± ì™„ë£Œ!</h2>
                    <h3>ê³µê°œ í‚¤ (Public Key) - í´ë¼ì´ì–¸íŠ¸ìš©</h3>
                    <div class="key-box">${publicKeyBase64}</div>
                    <p>ê¸¸ì´: ${publicKeyBase64.length} ë¬¸ì (ì •í™•íˆ 87ìì—¬ì•¼ í•¨)</p>
                    
                    <h3>ë¹„ê³µê°œ í‚¤ (Private Key) - ì„œë²„ìš©</h3>
                    <div class="key-box">${privateKeyBase64}</div>
                    <p>ê¸¸ì´: ${privateKeyBase64.length} ë¬¸ì</p>
                    
                    <h3>ğŸ“ config/app.phpì— ë³µì‚¬í•˜ì„¸ìš”:</h3>
                    <div class="key-box" style="background: #e7f3ff;">
define('VAPID_PUBLIC_KEY', '${publicKeyBase64}');<br>
define('VAPID_PRIVATE_KEY', '${privateKeyBase64}');
                    </div>
                    
                    <h3>âš ï¸ ì£¼ì˜:</h3>
                    <ul>
                        <li>ê³µê°œ í‚¤ëŠ” ì •í™•íˆ 87ìì—¬ì•¼ í•©ë‹ˆë‹¤</li>
                        <li>ë¹„ê³µê°œ í‚¤ëŠ” ì ˆëŒ€ ë…¸ì¶œí•˜ì§€ ë§ˆì„¸ìš”</li>
                        <li>ë‘ í‚¤ë¥¼ ëª¨ë‘ config/app.phpì— ì €ì¥í•˜ì„¸ìš”</li>
                    </ul>
                `;
                
                document.getElementById('result').innerHTML = html;
                
            } catch (error) {
                document.getElementById('result').innerHTML = `<p style="color: red;">ì˜¤ë¥˜: ${error.message}</p>`;
            }
        }
        
        // ìë™ ì‹¤í–‰
        window.onload = generate;
    </script>
</body>
</html>
