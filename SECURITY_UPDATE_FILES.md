# λ³΄μ• κ°•ν™” λ° λΉ„νμ› μμ•½ μ΅°ν μ—…λ°μ΄νΈ νμΌ

## π“¦ μ„λ²„μ— μ—…λ΅λ“ν•  νμΌ

### β… μƒλ΅ μ¶”κ°€λ νμΌ

```
1. pages/bookings/guest-check.php         # λΉ„νμ› μμ•½ μ΅°ν νμ΄μ§€
2. api/bookings/cancel-guest.php          # λΉ„νμ› μ·¨μ† API
3. includes/security.php                  # λ³΄μ• ν•¨μ (CSRF, μ•”νΈν™”)
4. config/encryption.php                  # μ•”νΈν™” ν‚¤ μ„¤μ •
```

### β… μμ •λ νμΌ

```
5. components/header.php                  # "μμ•½μ΅°ν" λ©”λ‰΄ μ¶”κ°€
6. pages/auth/login.php                   # CSRF λ³΄νΈ μ¶”κ°€
7. pages/manager/signup.php               # μ£Όλ―Όλ²νΈ μ•”νΈν™”, CSRF λ³΄νΈ
8. pages/admin/managers.php               # μ£Όλ―Όλ²νΈ λ§μ¤ν‚Ή ν‘μ‹
```

---

## π€ μ—…λ΅λ“ λ°©λ²•

### FTPλ΅ μ—…λ΅λ“

```
/includes/security.php          (μƒ νμΌ)
/config/encryption.php          (μƒ νμΌ)
/pages/bookings/guest-check.php (μƒ νμΌ)
/api/bookings/cancel-guest.php  (μƒ νμΌ)
/components/header.php          (λ®μ–΄μ“°κΈ°)
/pages/auth/login.php           (λ®μ–΄μ“°κΈ°)
/pages/manager/signup.php       (λ®μ–΄μ“°κΈ°)
/pages/admin/managers.php       (λ®μ–΄μ“°κΈ°)
```

---

## π” μ¶”κ°€ μ„¤μ • ν•„μ”

### config/hosting.phpμ— μ•”νΈν™” ν‚¤ μ¶”κ°€

```php
<?php
// κΈ°μ΅΄ μ„¤μ •...

// μ•”νΈν™” ν‚¤ (32μ μ΄μƒ κ°•λ ¥ν• ν‚¤)
define('ENCRYPTION_KEY', 'your-strong-32-character-encryption-key-here-change-this');
?>
```

**μ•”νΈν™” ν‚¤ μƒμ„± λ°©λ²•**:
```php
<?php
// λλ¤ ν‚¤ μƒμ„±
echo bin2hex(random_bytes(32)); // 64μ μ¶λ ¥
?>
```

---

## β¨ μƒλ΅μ΄ κΈ°λ¥

### 1. λΉ„νμ› μμ•½ μ΅°ν

**URL**: `/bookings/guest-check`

**κΈ°λ¥**:
- μμ•½λ²νΈ + μ „ν™”λ²νΈλ΅ μ΅°ν
- μμ•½ μƒμ„Έ μ •λ³΄ ν‘μ‹
- κ²°μ  μ •λ³΄ ν‘μ‹
- λ§¤λ‹μ € μ •λ³΄ ν‘μ‹
- λΉ„νμ›λ„ μ·¨μ† κ°€λ¥

**μ ‘κ·Ό**:
- ν—¤λ” λ©”λ‰΄ > "μμ•½μ΅°ν"
- λ¨λ°”μΌ/λ°μ¤ν¬νƒ‘ λ¨λ‘ ν‘μ‹

### 2. λ³΄μ• κ°•ν™”

#### CSRF λ³΄νΈ
- λ¨λ“  POST νΌμ— CSRF ν† ν° μλ™ μƒμ„±
- μ„λ²„μ—μ„ ν† ν° κ²€μ¦
- ν† ν° λ¶μΌμΉ μ‹ μ”μ²­ μ°¨λ‹¨

#### μ£Όλ―Όλ²νΈ μ•”νΈν™”
- λ§¤λ‹μ € κ°€μ… μ‹ μ£Όλ―Όλ²νΈ μλ™ μ•”νΈν™”
- DBμ— μ•”νΈν™”λ κ°’ μ €μ¥
- κ΄€λ¦¬μ νμ΄μ§€μ—μ„ λ§μ¤ν‚Ή ν‘μ‹ (μ: 700504-1*****)

#### XSS λ°©μ–΄
- `e()` ν•¨μλ΅ HTML μ¶λ ¥ μ•μ „ν™”
- λ¨λ“  μ‚¬μ©μ μ…λ ¥ μ΄μ¤μΌ€μ΄ν”„

---

## π§ ν…μ¤νΈ λ°©λ²•

### 1. λΉ„νμ› μμ•½ μ΅°ν ν…μ¤νΈ

```
1. λΉ„νμ›μΌλ΅ μ„λΉ„μ¤ μ‹ μ²­ λ° κ²°μ 
2. κ²°μ  μ™„λ£ ν›„ μμ•½λ²νΈ λ©”λ¨
3. ν—¤λ” > "μμ•½μ΅°ν" ν΄λ¦­
4. μμ•½λ²νΈ + μ „ν™”λ²νΈ μ…λ ¥
5. μμ•½ μ •λ³΄ ν™•μΈ
6. "μμ•½ μ·¨μ†" λ²„νΌ ν…μ¤νΈ
```

### 2. CSRF λ³΄νΈ ν…μ¤νΈ

```
1. λ΅κ·ΈμΈ νμ΄μ§€ μ ‘μ†
2. F12 (κ°λ°μ λ„κµ¬) > Elements
3. <form> μ•μ— <input type="hidden" name="csrf_token"> ν™•μΈ
4. ν† ν° κ°’ μ‚­μ  ν›„ λ΅κ·ΈμΈ μ‹λ„
5. "λ³΄μ• ν† ν°μ΄ μ ν¨ν•μ§€ μ•μµλ‹λ‹¤" μ¤λ¥ ν™•μΈ
```

### 3. μ£Όλ―Όλ²νΈ μ•”νΈν™” ν…μ¤νΈ

```
1. μƒ λ§¤λ‹μ € κ°€μ…
2. phpMyAdmin > managers ν…μ΄λΈ” ν™•μΈ
3. ssn μ»¬λΌμ΄ μ•”νΈν™”λ λ¬Έμμ—΄μΈμ§€ ν™•μΈ
4. κ΄€λ¦¬μ > λ§¤λ‹μ € κ΄€λ¦¬ νμ΄μ§€
5. μ£Όλ―Όλ²νΈκ°€ λ§μ¤ν‚Ήλμ–΄ ν‘μ‹λλ”μ§€ ν™•μΈ (700504-1*****)
```

---

## β οΈ μ£Όμμ‚¬ν•­

### 1. κΈ°μ΅΄ μ£Όλ―Όλ²νΈ λ°μ΄ν„°

**κΈ°μ΅΄ λ§¤λ‹μ €μ μ£Όλ―Όλ²νΈλ” ν‰λ¬ΈμΌλ΅ μ €μ¥λμ–΄ μμµλ‹λ‹¤!**

**λ§μ΄κ·Έλ μ΄μ… ν•„μ”**:
```php
<?php
// migrate_encrypt_ssn.php
require_once 'config/app.php';
require_once 'config/encryption.php';
require_once 'includes/security.php';

$pdo = require 'database/connect.php';

// ν‰λ¬Έ μ£Όλ―Όλ²νΈλ¥Ό μ•”νΈν™”
$st = $pdo->query("SELECT id, ssn FROM managers WHERE LENGTH(ssn) < 50");
$count = 0;

while ($row = $st->fetch(PDO::FETCH_ASSOC)) {
    $encrypted = encrypt_ssn($row['ssn']);
    $updateSt = $pdo->prepare("UPDATE managers SET ssn = ? WHERE id = ?");
    $updateSt->execute([$encrypted, $row['id']]);
    $count++;
}

echo "μ•”νΈν™” μ™„λ£: {$count}λ…";
?>
```

### 2. μ•”νΈν™” ν‚¤ κ΄€λ¦¬

- `ENCRYPTION_KEY`λ” μ λ€ λ³€κ²½ν•μ§€ λ§μ„Έμ”!
- ν‚¤λ¥Ό λ³€κ²½ν•λ©΄ κΈ°μ΅΄ μ•”νΈν™”λ λ°μ΄ν„°λ¥Ό λ³µνΈν™”ν•  μ μ—†μµλ‹λ‹¤
- ν‚¤λ” μ•μ „ν• κ³³μ— λ°±μ—…ν•μ„Έμ”

---

## π“ λ³΄μ• κ°μ„  μ”μ•½

| ν•­λ© | μ΄μ „ | κ°μ„  ν›„ |
|---|---|---|
| **CSRF λ³΄νΈ** | β μ—†μ | β… λ¨λ“  POST νΌ |
| **μ£Όλ―Όλ²νΈ** | β ν‰λ¬Έ μ €μ¥ | β… μ•”νΈν™” μ €μ¥ |
| **μ£Όλ―Όλ²νΈ ν‘μ‹** | β μ „μ²΄ λ…Έμ¶ | β… λ§μ¤ν‚Ή (700504-1*******) |
| **λΉ„νμ› μμ•½** | β μ΅°ν λ¶κ°€ | β… μ΅°ν/μ·¨μ† κ°€λ¥ |
| **XSS λ°©μ–΄** | β οΈ λ¶€λ¶„μ  | β… e() ν•¨μ μ κ³µ |

---

## π― λ°°ν¬ μ²΄ν¬λ¦¬μ¤νΈ

- [ ] 8κ° νμΌ FTP μ—…λ΅λ“
- [ ] `hosting.php`μ— `ENCRYPTION_KEY` μ¶”κ°€
- [ ] κΈ°μ΅΄ μ£Όλ―Όλ²νΈ μ•”νΈν™” (migrate_encrypt_ssn.php)
- [ ] λΉ„νμ› μμ•½ μ΅°ν ν…μ¤νΈ
- [ ] CSRF λ³΄νΈ ν…μ¤νΈ
- [ ] μ£Όλ―Όλ²νΈ λ§μ¤ν‚Ή ν™•μΈ

---

## π”— μƒλ΅μ΄ URL

```
λΉ„νμ› μμ•½ μ΅°ν: /bookings/guest-check
```

ν—¤λ” λ©”λ‰΄μ—μ„ "μμ•½μ΅°ν" ν΄λ¦­ν•λ©΄ μ ‘μ† κ°€λ¥!
